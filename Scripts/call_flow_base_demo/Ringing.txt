bool fStartedRingTone;

EVENT CallRinging()
{
	LOG("CallRinging in Ringing is interpreting");
	PlayBackgroundAudio(_LEG_A_, "ringing_tone", TRUE, 2);
	fStartedRingTone = TRUE;
}

EVENT CallAnswered()
{
	LOG("CallAnswered in Ringing is interpreting");
	StopBackgroundAudio(_LEG_A_);
	CloseAudioChannel(_LEG_A_);
	JoinLegs(_LEG_A_, _LEG_B_);	
	RunScript("CallMonitor.txt");
}

EVENT CallReject()
{
	LOG("CallReject in Ringing is interpreting");
	LOG("_RESPONSE_ = " + i2str(_RESPONSE_));
	if (_RESPONSE_ == 404) {
		LOG("Called number is not found");
		PlayAudio(_LEG_A_, "invalidno");
	}
	if (_RESPONSE_ == 486) {
		LOG("Called number is busy");
		PlayAudio(_LEG_A_, "Number_Busy");
	}
	if (_RESPONSE_ == 487 || _RESPONSE_ == 408) {
		LOG("Called number does not answer");
		PlayAudio(_LEG_A_, "Number_No_Answer");
	}
	StopBackgroundAudio(_LEG_A_);
	
	//Could not connect to B side. Another chance?
	CallAgain();
}

EVENT CallEnd()
{
	LOG("CallEnd in Ringing is interpreting");
	if (fStartedRingTone == TRUE)
	{
		StopBackgroundAudio(_LEG_A_);
	}
	CloseSession();
}